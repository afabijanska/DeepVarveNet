# DeepVarveNet

This crepository contains source code of a DeepVarveNet - a convolutional neural network for laminae detection in images of varved sediments.

# Running the code

## Prerequisites

Python 3.6, Tensorflow, Keras

## Data organization

Organize your data as below. For training, keep the filenames consistent (an original image and the corresponding ground truth should be files of the same name saved in diifferent locations).

<pre><code>
├───project_dir<br>
    └───allData<br>          # directory containing all image data available in the project
    |    └───DataDir1<br>    # directory containing images of first sendiment core
    |    |   └───bw<br>      # binary images (varve masks) - will created automatically by script ExtractMarkers.py
    |    |   |   File1.png <br>
    |    |   |   File2.png <br>
    |    |   └───gt<br>      # mannual delineations by an expert
    |    |   |   File1.png <br>
    |    |   |   File2.png <br>
    |    |   └───src<br>     # original images of varves
    |    |       File1.png <br>
    |    |       File2.png <br>
    |    └───DataDir2<br>    # directory containing images of second sendiment core
    |        └───bw<br>      # binary images (varve masks) - will created automatically by script ExtractMarkers.py
    |        |   File3.png <br>
    |        |   File4.png <br>
    |        └───gt<br>      # mannual delineations by an expert
    |        |   File3.png <br>
    |        |   File4.png <br>
    |        └───src<br>     # original images of varves
    |            File3.png <br>
    |            File4.png <br>
    └───train<br>          # directory containing train data (content will be generated by DivideTestTrain.py)
    |    └───bw<br>
    |    |   DataDir1_File1.png <br>
    |    |   DataDir2_File3.png <br>
    |    └───src<br>
    |        DataDir1_File1.png <br>
    |        DataDir2_File3.png <br>
    └───test<br>          # directory containing test data (sub dirs ./bw and ./src will be generated by DivideTestTrain.py) 
         └───bw<br>
         |   DataDir1_File2.png <br>
         |   DataDir2_File3.png <br>
         └───final<br>    # contains predicted varves overlied on original images (generated by GlaciersPredict.py)
         |   DataDir1_File2.png <br>
         |   DataDir2_File4.png <br>
         └───preds<br>   # contains varve probability maps (generated by GlaciersPredict.py)
         |   DataDir1_File2.png <br>
         |   DataDir2_File3.png <br>
         └───src<br>
             DataDir1_File2.png <br>
             DataDir2_File4.png <br>
        
</code></pre>


## Repository content

<ul>
  <li> <b>configuration.txt</b><br> -- file to be edited; <br> -- contains data paths and train/test setings;   
  <li> <b>ExtractMarkers.py</b><br> -- script for extracting manual varve delineations provided by an expert; <br> -- it assumed that delineations are provided in pure blue (R=0, G=0, B=255) as markings on original images; <br> -- to be run 1st;
  <li> <b>DivideTestTrain.py</b><br> -- script for dividing data into training and testing set; <br> -- to be run 2nd; 
  <li> <b>GlaciersGenerateData.py</b><br> -- script for extracting train patches and the corresponding labels from the images from the train set; <br> -- an equal number of patches is extracted from each train image; <br> -- to be run 3rd;
  <li> <b>GlaciersTrainCNNpix.py</b><br> -- script for training the DeepVarveNet with the train patches and the corresponding labels<br> -- to be run 4th;
  <li> <b>GlaciersPredict.py</b><br> -- script for finding varves in test images with the use of trained DeepVarveNet; <br> -- to be run 5th;
  <li> <b>models.py</b><br> -- file that defines architecture of a DeepVarveNet;
  <li> <b>GlaciersHelpers.py</b><br> -- some helper functions;
</ul>

# Contact

<b>Anna Fabijańska</b><br>
Institute of Applied Computer Science<br>
Lodz University of Technology<br>
e-mail: anna.fabijanska@p.lodz.pl<br> 
WWW: http://an-fab.kis.p.lodz.pl
